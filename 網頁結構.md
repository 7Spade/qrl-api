# 網頁／接口層結構（interfaces/http）

目標：控制器只負責 HTTP/TASK 入口與驗證，業務邏輯留在 `application`，協定細節在 `infrastructure`。

## 控制器切分

- 一個路由群組一檔，對應 `ARCHITECTURE_TREE.md`：
  - `account.py`、`market.py`、`bot.py`、`status.py`、`sub_account.py`
- 行為命名：`get_balance`, `list_orders`, `get_price` 等，回傳 DTO（由 application 提供）。
- 不允許：
  - 直接觸碰 Redis/MEXC/外部 IO。
  - 在控制器內實作策略或風控。

## 任務／排程（interfaces/tasks）

- 建議結構：
  - `tasks/mexc/sync_market.py`
  - `tasks/mexc/sync_account.py`
  - `tasks/mexc/sync_trades.py`
  - `tasks/auth.py`
- 任務只做觸發與參數驗證，核心邏輯委派給 `application` 或 `bot_runtime`。

## DTO 與驗證

- Request/Response schema 由 `application/*/dto.py` 定義，控制器引用以保持一致。
- 入口驗證使用 Pydantic（與 FastAPI 相容），避免在控制器內寫業務校驗。

## 路由掛載與組裝

- `bootstrap.py` 建立 FastAPI app，掛載控制器與中介層。
- 路由註冊集中管理，避免在業務層隱式建立 router。
- 中介層僅負責跨切面：trace、auth、rate limit；不得含業務。

## 遷移順序（建議）

1. 在 `interfaces/http/` 建立與現有 `api/` 等價的路由檔，導入既有 handler 邏輯。
2. 逐步把 handler 內的業務邏輯抽出到 `application`，控制器僅保留轉換與錯誤處理。
3. 將對 Redis/MEXC 的直接呼叫換成注入的 port/adapters。
4. 補測試：每個控制器至少一個 happy-path、one failure-path；任務至少驗證排程參數。

更多遷移步驟請見《調整結構.md》。
