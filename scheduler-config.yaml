# Cloud Scheduler Configuration for QRL Trading Bot
# 此配置文件定義了 3 個 Cloud Scheduler jobs
# 用於 Google Cloud Run 的自動化任務調度

# Job 1: 01-min-job (Balance Sync) - 每 1 分鐘執行一次
---
apiVersion: cloudscheduler.cnrm.cloud.google.com/v1beta1
kind: CloudSchedulerJob
metadata:
  name: qrl-01-min-job
  annotations:
    cnrm.cloud.google.com/project-id: "qrl-api"  # 替換為您的專案 ID
spec:
  location: asia-southeast1
  description: "01-min-job: Sync MEXC account balance to Redis every 1 minute"
  schedule: "*/1 * * * *"  # 每 1 分鐘執行
  timeZone: "Asia/Taipei"
  attemptDeadline: "60s"
  retryConfig:
    retryCount: 3
    maxRetryDuration: "0s"
    minBackoffDuration: "5s"
    maxBackoffDuration: "3600s"
    maxDoublings: 5
  httpTarget:
    uri: "https://qrl-trading-api-545492969490.asia-southeast1.run.app/tasks/01-min-job"
    httpMethod: "POST"
    headers:
      X-CloudScheduler: "true"
      Content-Type: "application/json"
    body: "{}"

---
# Job 2: 05-min-job (Price Update) - 每 5 分鐘執行一次
apiVersion: cloudscheduler.cnrm.cloud.google.com/v1beta1
kind: CloudSchedulerJob
metadata:
  name: qrl-05-min-job
  annotations:
    cnrm.cloud.google.com/project-id: "qrl-api"  # 替換為您的專案 ID
spec:
  location: asia-southeast1
  description: "05-min-job: Update QRL/USDT price from MEXC every 5 minutes"
  schedule: "*/5 * * * *"  # 每 5 分鐘執行
  timeZone: "Asia/Taipei"
  attemptDeadline: "60s"
  retryConfig:
    retryCount: 3
    maxRetryDuration: "0s"
    minBackoffDuration: "5s"
    maxBackoffDuration: "3600s"
    maxDoublings: 5
  httpTarget:
    uri: "https://qrl-trading-api-545492969490.asia-southeast1.run.app/tasks/05-min-job"
    httpMethod: "POST"
    headers:
      X-CloudScheduler: "true"
      Content-Type: "application/json"
    body: "{}"

---
# Job 3: 15-min-job (Cost Update) - 每 15 分鐘執行一次
apiVersion: cloudscheduler.cnrm.cloud.google.com/v1beta1
kind: CloudSchedulerJob
metadata:
  name: qrl-15-min-job
  annotations:
    cnrm.cloud.google.com/project-id: "qrl-api"  # 替換為您的專案 ID
spec:
  location: asia-southeast1
  description: "15-min-job: Update cost and PnL calculations every 15 minutes"
  schedule: "*/15 * * * *"  # 每 15 分鐘執行
  timeZone: "Asia/Taipei"
  attemptDeadline: "60s"
  retryConfig:
    retryCount: 3
    maxRetryDuration: "0s"
    minBackoffDuration: "5s"
    maxBackoffDuration: "3600s"
    maxDoublings: 5
  httpTarget:
    uri: "https://qrl-trading-api-545492969490.asia-southeast1.run.app/tasks/15-min-job"
    httpMethod: "POST"
    headers:
      X-CloudScheduler: "true"
      Content-Type: "application/json"
    body: "{}"
